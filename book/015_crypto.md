---
layout: book
title: 有意思的加密通信
---

互联网就是个公开演讲的广场。意思是任何人说任何话，其实别人都是能听见的。这个认为是互联网的天性了，那么在这个前提下如果我和我一个朋友说点机密的事情，同时不想让别人偷听到，那这个就成了一个有点挑战性的技术问题，也就是今天我们要讨论的加密通信。

![](http://peterpic.qiniudn.com/mim.png)


### 对称加密
先说说传统的“对称性加密”为啥不能用在互联网上的加密通信中？先说说这个过程，我们有一个文件，用一定的加密方式来进行加密（比如用一些文件压缩程序），然后我们可以安全的把加密后的这个包，传递给我的朋友，到目前为止一切都好。但是接下来的问题是，我朋友如何才能解密我给他的文件呢，先然我必须安全的把我加密时输入的密码安全的传递给他，这样才能完成这个加密通信过程。所以这就有了一个鸡和蛋的问题。最终我可能就不得不借助互联网以外的工具，例如打电话，来首先安全的把密码给我朋友了。回过头来看整个过程，这种加密通信的方式，由于加密和解密用的是同一个密码，所以通常我们把它叫做“对称性加密”。现在我们知道了，对称性加密是不适合用于互联网上的加密通信的。

![](http://peterpic.qiniudn.com/dui_chen.png)

### 非对称加密的原理
那我们就可以想到是不是有一种“非对称加密”的方法能解决鸡和蛋的问题呢？恭喜你，答对了！非对称加密用一句话来描述就是，加密是用一个 key，而解密则会用另外一个 key。听起来挺难理解，我们来实际操作一下。首先，我们先来运行一个命令叫做 ssh-keygen 用来生成一对 key，得到两个文件，一个叫做 id_rsa，这个叫做私钥，意思是里面的内容要要严格保密的，另外一个有 .pub 后缀，我们自然可以猜到这是 public 的缩写，这个叫做公钥，是要公开给他人用的。

这两个 key 是一对，意思是他们在数学角度是有着联系的，但是如果想要从公钥计算出私钥也是基本不可能的。加密通信的过程是这样的，收信人，比如说我，先生成这一对 key，然后我想跟我的朋友秘密通话，那我就把我的 publickey 传给他，这个反正有人得到也没关系。我朋友拿到 pubkey 之后，就把他想要跟我说的话，用 pubkey 进行加密，然后把加密后的信息通过互联网传给我，整个互联网上，及时有其他人得到了这些加密数据也没用，因为只有我拥有跟那个 pubkey 配对的这个 prvkey，所以也就只有我，才可以解密这个信息。所以，pubkey 也被叫做加密 key，prvkey 也被叫做解密 key。

![](http://peterpic.qiniudn.com/fei_duicheng.png)

### 非对称加密的类比和应用

我们再来打个比方。我家门口有个信箱，那么凡是知道我家地址的人就可以给我发信了，所以我家的地址就相当于 pubkey，但是由于只有我自己有信箱的钥匙，所以也只有我能看到信。那这个信箱的钥匙当然就相当于 prvkey 了。


打一个比方。我和朋友要秘密的通信。首先我要我朋友给我他的没有锁上的密码锁，然后我把信放到一个盒子里，锁上，给他寄过去，他拿到盒子之后因为他自己知道他自己的锁的密码，所以当然是可以打开箱子的。反过来，如果我想从她那里得到回信，那我就给他寄我的一个没锁上的密码锁就行了。这种通信方式的好处是，任何一把锁的钥匙都没有真正的邮寄过。

![](http://peterpic.qiniudn.com/letter.png)

实际在互联网情况下的一个应用场景。我在北京，如果我有一台服务器在美国，那么我如何让信息从我的服务骑上安全的传递到我这里呢？首先，我先生成一对 key，然后我就把 pubkey 传到我的服务器上，这样，我的服务器就可以把信息加密，然后传递给我了，听起来可能比较麻烦，但是实际中又 ssh 这样的程序帮忙，其实加密和解密过程都是自动完成的。

~~~
$> ssh-keygen
Generating public/private rsa key pair.
$> ls .ssh/
id_rsa id_rsa.pub
~~~

### 参考资料：
  - <http://en.wikipedia.org/wiki/Public-key_cryptography>
  - <http://blog.agupieware.com/2014/05/online-learning-bachelors-level.html>

